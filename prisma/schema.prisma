generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String    @id @default(cuid())
  email            String    @unique
  passwordHash     String
  name             String?
  eggPricePerUnit  Float?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  chickens         Chicken[]
}

model Chicken {
  id          String        @id @default(cuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  breed       String
  birthDate   DateTime
  status      ChickenStatus
  source      ChickenSource @default(purchased)
  purchasePrice Float?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  broodCycles BroodCycle[]
  expenses    Expense[]

  @@index([userId])
}

enum ChickenStatus {
  chick
  pullet
  laying
  brooding
  recovering
  retired
  sold
  deceased
}

enum ChickenSource {
  purchased
  hatched
}

model BroodCycle {
  id                      String   @id @default(cuid())
  chickenId                String
  chicken                  Chicken  @relation(fields: [chickenId], references: [id], onDelete: Cascade)
  startDate                DateTime
  eggCount                 Int
  expectedHatchDate        DateTime
  expectedReturnToLayDate  DateTime
  actualHatchedCount       Int?
  status                   String
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  @@index([chickenId])
}

enum FeedType {
  pre_inicial
  crescimento
  postura
}

model FeedInventory {
  id                    String   @id @default(cuid())
  userId                String
  name                  String
  feedType              FeedType
  weightKg              Float
  price                 Float?
  consumptionPerBirdGrams Float
  purchaseDate          DateTime
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  expense               Expense?

  @@index([userId])
}

model Expense {
  id                String         @id @default(cuid())
  userId            String
  amount            Float
  description       String?
  category          String?
  date              DateTime
  chickenId         String?        @unique
  feedInventoryId   String?        @unique
  chicken           Chicken?       @relation(fields: [chickenId], references: [id], onDelete: SetNull)
  feedInventory     FeedInventory? @relation(fields: [feedInventoryId], references: [id], onDelete: SetNull)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([userId])
  @@index([userId, date])
}

model Revenue {
  id          String   @id @default(cuid())
  userId      String
  amount      Float
  description String?
  source      String?
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([userId, date])
}
